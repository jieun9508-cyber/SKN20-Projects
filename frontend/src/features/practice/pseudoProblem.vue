<template>
  <div v-if="isOpen" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in" @click.self="$emit('close')">
    <div class="bg-[#0a0e17] w-full max-w-7xl h-[90vh] rounded-3xl border border-white/10 shadow-2xl overflow-hidden flex flex-col relative animate-scale-in">
      
    <!-- HUD Header -->
    <header class="h-20 border-b border-white/5 bg-[#07090e] flex justify-between items-center px-10 relative overflow-hidden shrink-0">
      <div class="flex items-center space-x-6 z-10">
        <!-- Exact Logo Match -->
        <div class="w-10 h-10 bg-[#117e96] rounded flex items-center justify-center">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 8L11 12L7 16M13 16H17" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="space-y-0">
          <h1 class="font-black text-2xl tracking-tighter text-white uppercase italic leading-none">PROJECT: RE-BOOT</h1>
          <div class="text-[12px] font-bold text-cyan-400/60 uppercase tracking-widest mt-1">
            Stage {{ currentStep }}: Data Cleaning Protocol
          </div>
        </div>
      </div>

      <div class="flex items-center gap-8 z-10">
        <div class="flex items-center gap-2 font-mono text-xs">
          <span class="text-gray-500 uppercase tracking-widest">SYS_STATUS:</span>
          <span class="text-[#4ade80] font-black animate-pulse">STABLE</span>
        </div>
        
        <button 
          @click="$emit('close')" 
          class="flex items-center justify-center w-10 h-10 rounded hover:bg-white/5 transition-all text-gray-500 hover:text-white"
        >
          <X class="w-6 h-6" />
        </button>
      </div>
      
      <!-- Top Neon Line -->
      <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan-500/20 to-transparent"></div>
    </header>



    <!-- Main Content -->
    <main class="flex-1 p-6 lg:p-12 max-w-7xl mx-auto w-full relative flex flex-col min-h-0 overflow-y-auto custom-scrollbar bg-[#07090e]">
      <!-- Glow Decor -->
      <div class="absolute top-0 left-1/4 w-[600px] h-[600px] bg-cyan-500/[0.03] rounded-full blur-[120px] pointer-events-none"></div>
      <div class="absolute bottom-0 right-1/4 w-[600px] h-[600px] bg-pink-500/[0.03] rounded-full blur-[120px] pointer-events-none"></div>


      <!-- HUD Progress (Pill Style Match) -->
      <div v-if="currentStep <= 4" class="max-w-6xl mx-auto w-full mb-12 px-4 shrink-0">
        <div class="grid grid-cols-4 gap-6 h-3">
           <div 
             v-for="i in 4" 
             :key="i"
             class="relative h-full transition-all duration-700 rounded-full bg-white/10"
           >
             <div 
               v-if="i <= currentStep" 
               class="absolute inset-0 bg-cyan-400 rounded-full shadow-[0_0_20px_rgba(0,243,255,0.6)]"
               :class="i === currentStep ? 'animate-pulse' : ''"
             ></div>
           </div>
        </div>
      </div>


      <!-- STAGE 1: Quiz (Refined Clean Aesthetic) -->
      <div v-if="currentStep === 1" class="grid grid-cols-1 lg:grid-cols-[1fr_1.2fr] gap-8 animate-fade-in-up items-stretch max-w-6xl mx-auto w-full flex-1 min-h-0">
        <!-- Info Card -->
        <div class="bg-[#0b0e14] border border-white/5 p-10 rounded-2xl flex flex-col relative overflow-hidden group shadow-2xl">
          <div class="flex items-center gap-4 mb-4">
            <div class="p-3 bg-cyan-500/10 rounded-xl border border-cyan-500/20">
              <Cpu class="text-cyan-400 w-8 h-8" />
            </div>
            <h2 class="text-3xl font-black text-[#00f3ff] italic tracking-tighter uppercase">Stage 1: ì˜¤ì—¼ëœ ê¸°ì–µ</h2>
          </div>

          <div class="space-y-8 text-gray-400 leading-relaxed font-medium">
            <p class="text-[17px] text-[#8b949e]">Lionì˜ ë©”ëª¨ë¦¬ ë±…í¬ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤. ë³µêµ¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ê°€ì¥ ì¤‘ìš”í•œ ì›ì¹™ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>
            
            <div class="bg-[#0d1117] p-8 border border-white/5 rounded-xl relative overflow-hidden group/gigo mt-auto">
               <h3 class="text-cyan-400 font-bold text-lg mb-4 flex items-center gap-2">
                 í•µì‹¬ ê°œë…: GIGO (Garbage In, Garbage Out)
               </h3>
               <p class="text-lg text-white font-medium leading-relaxed">
                 "ì“°ë ˆê¸°ê°€ ë“¤ì–´ê°€ë©´ ì“°ë ˆê¸°ê°€ ë‚˜ì˜¨ë‹¤."
               </p>
               <p class="text-sm text-[#8b949e] mt-2">
                 ëª¨ë¸ì´ ì•„ë¬´ë¦¬ ë›°ì–´ë‚˜ë„, í•™ìŠµ ë°ì´í„°ì˜ í’ˆì§ˆì´ ë‚®ìœ¼ë©´ ê²°ê³¼ë¬¼ë„ ì—‰ë§ì´ ë©ë‹ˆë‹¤.
               </p>
            </div>
          </div>
        </div>

        <!-- Quiz Card -->
        <div class="bg-[#0b0e14] border border-white/5 p-10 rounded-2xl flex flex-col shadow-2xl">
          <h3 class="text-2xl font-black text-white mb-10 leading-tight">Q. ë‹¤ìŒ ì¤‘ ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê°€ì¥ íƒ€ë‹¹í•œ ì´ìœ ëŠ”?</h3>

          <div class="space-y-4 flex-1">
            <button
              v-for="(opt, idx) in step1Options"
              :key="idx"
              @click="handleStep1Submit(idx)"
              class="w-full text-left p-6 bg-[#161b22] hover:bg-cyan-500/10 border border-transparent hover:border-cyan-500/30 transition-all group flex items-center rounded-xl"
            >
              <span class="flex-1 font-bold text-[#c9d1d9] group-hover:text-white transition-colors">
                {{ idx + 1 }}. {{ opt }}
              </span>
            </button>
          </div>
        </div>
      </div>


      <!-- STAGE 2: Pseudocode -->
      <div v-if="currentStep === 2" class="grid grid-cols-1 lg:grid-cols-2 gap-10 animate-fade-in-up items-stretch max-w-7xl mx-auto w-full flex-1 min-h-0">
        <div class="flex flex-col gap-10 min-h-0">
          <!-- Problem Definition HUD -->
          <div class="bg-black/40 border border-cyan-500/20 p-10 hud-box-clip flex-1 relative overflow-hidden group min-h-[200px]">
            <h3 class="text-2xl font-black text-white italic mb-6 flex items-center gap-3">
              <CodeIcon class="w-6 h-6 text-cyan-400" /> MISSION_OBJECTIVE
            </h3>
            <div class="space-y-6">
              <p class="text-gray-300 leading-relaxed font-bold text-lg">
                ë¦¬ìŠ¤íŠ¸ì— ë‹´ê¸´ ë‰´ìŠ¤ ì œëª©ë“¤ ì¤‘ <span class="bg-cyan-500/20 text-cyan-300 px-2 rounded">"ê´‘ê³ "</span>, <span class="bg-cyan-500/20 text-cyan-300 px-2 rounded">"í´ë¦­"</span>ì´ í¬í•¨ëœ ì œëª©ê³¼, <span class="bg-pink-500/20 text-pink-300 px-2 rounded">ê¸¸ì´ê°€ 5ì ë¯¸ë§Œ</span>ì¸ ë°ì´í„°ë¥¼ ì œê±°í•˜ëŠ” í•„í„°ë§ ë¡œì§ì„ ì„¤ê³„í•˜ì‹­ì‹œì˜¤.
              </p>
              
              <div class="h-px bg-gradient-to-r from-cyan-500/50 to-transparent"></div>
              
              <div class="flex flex-wrap gap-2 uppercase font-mono text-[9px]">
                <div v-for="tag in ['iteration', 'conditional', 'filtering', 'data_cleaning']" :key="tag" class="px-2 py-1 bg-white/5 border border-white/10 text-gray-500">{{ tag }}</div>
              </div>
            </div>
            
            <!-- Matrix background effect -->
            <div class="absolute bottom-4 right-4 text-[40px] font-black text-white/[0.02] select-none pointer-events-none">0101101</div>
          </div>

          <!-- Lion Chat HUD -->
          <div class="bg-black/60 border border-white/5 hud-box-clip flex-[0.8] flex flex-col overflow-hidden relative max-h-[400px]">
            <div class="bg-white/5 p-3 text-[10px] font-mono text-cyan-400/50 border-b border-white/5 flex justify-between items-center tracking-widest px-6 italic uppercase">
              <span>Agent_Link_Active</span>
              <span class="flex items-center gap-2"><div class="w-1.5 h-1.5 rounded-full bg-cyan-500 animate-pulse"></div> ENCRYPTED</span>
            </div>
            <div ref="chatContainer" class="flex-1 overflow-y-auto p-8 space-y-6 custom-scrollbar">
              <div
                v-for="(msg, idx) in chatMessages"
                :key="idx"
                class="flex flex-col"
                :class="msg.sender === 'User' ? 'items-end' : 'items-start'"
              >
                <span class="text-[8px] text-gray-500 font-black mb-2 uppercase tracking-tighter">{{ msg.sender }}_ID</span>
                <div
                  class="max-w-[90%] p-4 text-sm leading-relaxed hud-button-clip"
                  :class="msg.sender === 'Lion' ? 'bg-cyan-500/10 text-cyan-100 border border-cyan-500/20' : 'bg-white/5 text-white border border-white/10'"
                >
                  {{ msg.text }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Input Area HUD -->
        <div class="bg-white/[0.02] border border-white/10 p-10 hud-box-clip flex flex-col items-stretch relative">
          <div class="flex items-center justify-between mb-8">
            <h3 class="text-xl font-black text-white tracking-widest">PSEUDO_COMPILER</h3>
            <div class="text-[9px] font-mono text-gray-500 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></span> WAITING_FOR_INPUT
            </div>
          </div>
          
          <div class="relative flex-1 flex flex-col">
            <textarea
              v-model="pseudoInput"
              class="flex-1 bg-black/40 text-cyan-100 p-8 font-mono text-sm border-2 border-white/5 focus:border-cyan-500/50 focus:outline-none resize-none leading-relaxed placeholder-gray-700 transition-all custom-scrollbar shadow-inner"
              placeholder="[SYSTEM]: Input logic sequence here...&#10;> 1. Fetch news data...&#10;> 2. Validate keywords..."
            ></textarea>
            
            <!-- Corner Accents -->
            <div class="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-cyan-500/30"></div>
            <div class="absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-cyan-500/30"></div>
          </div>

          <button
            @click="submitStep2"
            class="mt-10 group relative transition-all active:scale-[0.98]"
          >
            <div class="absolute -inset-1 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-lg blur opacity-25 group-hover:opacity-100 transition duration-1000"></div>
            <div class="relative w-full py-5 bg-black border border-cyan-500/50 text-white font-black text-lg tracking-widest uppercase hover:bg-cyan-500/10 transition-all hud-button-clip">
              Submit_Logic_Node
            </div>
          </button>
        </div>
      </div>



      <!-- STAGE 3: Python Blocks Refined -->
      <div v-if="currentStep === 3" class="grid grid-cols-1 lg:grid-cols-[1fr_1.2fr] gap-10 animate-fade-in-up items-stretch max-w-7xl mx-auto w-full flex-1 min-h-0">
        <!-- Left: Code Block Storage -->
        <div class="bg-[#0f1219]/60 border border-white/5 p-10 hud-box-clip flex flex-col relative group min-h-0">
          <div class="absolute inset-0 bg-gradient-to-b from-cyan-500/[0.02] to-transparent pointer-events-none"></div>
          
          <div class="mb-10 relative shrink-0">
            <h3 class="text-2xl font-black text-cyan-400 italic tracking-tighter uppercase mb-2">ì½”ë“œ ë¸”ë¡ ë³´ê´€í•¨</h3>
            <p class="text-gray-400 text-sm leading-relaxed font-bold">
              ì•„ë˜ ë¸”ë¡ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•œ í›„, ì˜¤ë¥¸ìª½ ì½”ë“œì˜ ë¹ˆì¹¸ì„ í´ë¦­í•´ ì±„ì›Œë„£ìœ¼ì„¸ìš”.
            </p>
            <div class="absolute -left-10 top-0 w-1 h-full bg-cyan-500/50"></div>
          </div>
          
          <!-- Blocks Grid - Fixed Height Scrollable -->
          <div class="grid grid-cols-2 gap-4 flex-1 overflow-y-auto custom-scrollbar pr-4 min-h-0">
            <button
              v-for="block in blocks"
              :key="block.id"
              @click="selectedBlock = block"
              class="group relative h-28 transition-all active:scale-[0.98]"
            >
              <div 
                class="absolute inset-0 bg-black/40 border transition-all duration-300 hud-box-clip"
                :class="selectedBlock && selectedBlock.id === block.id ? 'border-cyan-500 shadow-[0_0_20px_rgba(0,243,255,0.2)] bg-cyan-500/10' : 'border-white/10 group-hover:border-cyan-500/30'"
              ></div>
              <div class="relative h-full flex items-center justify-center px-4">
                <span 
                  class="text-base font-black tracking-widest uppercase transition-all"
                  :class="selectedBlock && selectedBlock.id === block.id ? 'text-cyan-400' : 'text-gray-400 group-hover:text-cyan-300'"
                >
                  {{ block.text }}
                </span>
              </div>
            </button>
          </div>

          <!-- Tip Box -->
          <div class="mt-8 p-6 bg-white/[0.02] border-l-2 border-pink-500 hud-box-clip relative overflow-hidden shrink-0">
             <div class="absolute top-0 right-0 w-16 h-16 bg-pink-500/5 rotate-45 translate-x-8 -translate-y-8"></div>
             <p class="text-[13px] text-gray-400 leading-relaxed font-bold italic">
               <span class="text-pink-500 not-italic font-black mr-2">Tip:</span> continueëŠ” ê±´ë„ˆë›°ê¸°, breakëŠ” ë©ˆì¶”ê¸°ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëê¹Œì§€ ë‹¤ ê²€ì‚¬í•´ì•¼ í•´ìš”.
             </p>
          </div>
        </div>

        <!-- Right: Python Executor -->
        <div class="bg-[#1a1a1a] border border-white/5 hud-box-clip flex flex-col relative overflow-hidden group shadow-2xl min-h-0">
          <!-- source header -->
          <div class="p-4 px-8 flex justify-end items-center shrink-0">
             <span class="text-[11px] font-mono text-gray-600 uppercase tracking-widest italic">data_cleaning.py</span>
          </div>

          <div class="flex-1 p-12 relative overflow-y-auto custom-scrollbar min-h-0" style="font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;">
            <!-- Code Structure -->
            <div class="text-[17px] leading-[2.4] font-medium text-gray-300">
              <pre>def clean_news_data(news_list):
    cleaned_data = []

    for news in news_list:
        <span class="text-gray-500 italic"># 1. ê¸¸ì´ ì²´í¬ ë° í‚¤ì›Œë“œ í•„í„°ë§</span>
        if len(news) < 5 or "ê´‘ê³ " in news:</pre>
              
              <!-- Blank A -->
              <div class="flex items-center gap-4 pl-12 h-14">
                 <div 
                   @click="fillBlank('blankA')"
                   class="min-w-[200px] border-b-2 transition-all cursor-pointer flex items-center justify-center relative group/blank"
                   :class="pythonBlanks.blankA ? 'border-cyan-500 text-cyan-400' : 'border-gray-700 hover:border-gray-500 bg-white/[0.02]'"
                 >
                   <span class="text-sm font-bold tracking-widest">{{ pythonBlanks.blankA ? pythonBlanks.blankA.text : "__________" }}</span>
                   <div class="ml-4 text-[12px] text-gray-600 font-bold tracking-tighter">__(A)__</div>
                 </div>
              </div>

              <pre class="mt-4">
        <span class="text-gray-500 italic"># 2. ìœ íš¨í•œ ë°ì´í„° ì €ì¥</span></pre>

              <!-- Blank B -->
              <div class="flex items-center pl-12 h-14">
                <span>cleaned_data.</span>
                <div 
                  @click="fillBlank('blankB')"
                  class="min-w-[200px] border-b-2 transition-all cursor-pointer flex items-center justify-center relative group/blank mx-2"
                  :class="pythonBlanks.blankB ? 'border-cyan-500 text-cyan-400' : 'border-gray-700 hover:border-gray-500 bg-white/[0.02]'"
                >
                  <span class="text-sm font-bold tracking-widest">{{ pythonBlanks.blankB ? pythonBlanks.blankB.text : "__________" }}</span>
                </div>
                <div class="text-[12px] text-gray-600 font-bold tracking-tighter ml-4">__(B)__</div>
              </div>

              <pre class="mt-6">    return cleaned_data</pre>
            </div>

            <!-- Execution Button (Bottom Right) -->
            <div class="absolute bottom-8 right-8">
              <button 
                @click="runSimulation" 
                class="group relative h-12 transition-all active:scale-[0.98]"
                :disabled="isSimulating"
              >
                <div class="relative px-8 h-full bg-[#117e96] hover:bg-[#1491ad] text-white font-bold text-sm tracking-wide transition-all flex items-center justify-center rounded-sm">
                  <div v-if="isSimulating" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-3"></div>
                  {{ isSimulating ? 'ì‹¤í–‰ ì¤‘...' : 'ì½”ë“œ ì‹¤í–‰ ë° ê²€ì¦' }}
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>


      <!-- STAGE 4: Deep Dive HUD -->
      <div v-if="currentStep === 4" class="grid grid-cols-1 lg:grid-cols-2 gap-12 animate-fade-in-up items-stretch max-w-6xl mx-auto w-full flex-1 min-h-0">
        <div class="flex flex-col min-h-0">
          <div class="bg-black/40 border border-pink-500/20 p-10 relative group overflow-hidden flex-1 hud-box-clip min-h-0">
            <div class="absolute top-0 right-0 w-32 h-32 bg-pink-500/5 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-pink-500/10 transition-all duration-1000"></div>
            
            <div class="flex items-center gap-4 mb-8">
              <div class="p-3 bg-pink-500/10 rounded-xl border border-pink-500/30">
                <Award class="text-pink-400 w-8 h-8" />
              </div>
              <div>
                <h2 class="text-3xl font-black text-white italic tracking-tighter uppercase">ANOMALY_DETECTION</h2>
                <p class="text-[10px] text-pink-500 font-mono tracking-widest">SUB_MODULE: DATA_LOSS_PREVENTION</p>
              </div>
            </div>

            <div class="space-y-8 text-gray-400 leading-relaxed font-medium">
              <p class="text-lg text-white/90">ì „ì²˜ë¦¬ê°€ ì§€ë‚˜ì¹˜ê²Œ ì™„ë²½í•˜ë©´, ìœ íš¨í•œ ë°ì´í„°ê¹Œì§€ 'ì˜¤ì—¼ë¬¼'ë¡œ ë¶„ë¥˜ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.</p>
              
              <div class="relative pt-6">
                <div class="absolute top-0 left-0 w-8 h-1 bg-pink-500"></div>
                <h3 class="text-pink-300 font-black text-xs uppercase tracking-[0.3em] mb-4">ENGINEERING ISSUE: TRADE-OFF</h3>
                <div class="bg-pink-500/5 p-8 border border-pink-500/10 relative overflow-hidden group">
                   <p class="text-xl text-white italic mb-4 font-black">"False Positives vs Information Loss"</p>
                   <p class="text-sm text-gray-500 leading-relaxed italic">
                     "ê´‘ê³ "ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ê¸°ê³„ì ìœ¼ë¡œ ì‚­ì œí•œë‹¤ë©´, <span class="text-pink-300">"ê´‘ê³  ì—…ê³„ì˜ ë™í–¥"</span>ê³¼ ê°™ì€ ì¤‘ìš”í•œ ë‰´ìŠ¤ë§ˆì € ì†Œì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                   </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-col gap-6">
          <div class="bg-black/40 border border-white/10 p-10 hud-box-clip flex-1 flex flex-col">
            <h3 class="text-xl font-black text-white mb-8 leading-tight uppercase tracking-tight">Q. í•„í„°ë§ì˜ ë¶€ì‘ìš©ì„ ìµœì†Œí™”í•˜ê³  ì •ë³´ì˜ ê°€ì¹˜ë¥¼ ë³´ì¡´í•˜ê¸° ìœ„í•œ ìµœì ì˜ ì—”ì§€ë‹ˆì–´ë§ ì ‘ê·¼ì€?</h3>

            <div class="space-y-4">
              <button
                v-for="(opt, idx) in step4Options"
                :key="idx"
                @click="handleStep4Submit(idx)"
                class="w-full text-left p-6 bg-white/[0.02] hover:bg-pink-500/10 border border-white/5 hover:border-pink-500/30 transition-all group relative overflow-hidden hud-button-clip"
              >
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-white/5 border border-white/10 flex items-center justify-center mr-5 text-xs font-mono text-pink-400 group-hover:bg-pink-500 group-hover:text-black transition-all">
                    0{{ idx + 1 }}
                  </div>
                  <span class="flex-1 font-bold text-gray-300 group-hover:text-white transition-colors">{{ opt }}</span>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>



      <!-- STAGE 5: Final Report HUD Refined -->
      <div v-if="currentStep === 5" class="flex flex-col items-center justify-center animate-fade-in-up py-6 max-w-6xl mx-auto w-full h-full">
        <div class="bg-black/80 border border-cyan-500/20 hud-box-clip w-full p-16 text-center relative overflow-hidden backdrop-blur-3xl group shadow-[0_0_100px_rgba(0,0,0,1)]">
          <!-- Cinematic background grids -->
          <div class="absolute inset-0 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:60px_60px] opacity-30"></div>
          <div class="absolute inset-0 bg-gradient-to-t from-cyan-500/10 via-transparent to-transparent"></div>
          
          <div class="relative z-10 space-y-16">
            <!-- Header Section -->
            <div class="space-y-6">
              <div class="inline-block relative">
                 <div class="absolute -inset-8 bg-cyan-500/20 blur-2xl rounded-full scale-110 animate-pulse"></div>
                 <Award class="w-32 h-32 text-cyan-400 mx-auto drop-shadow-[0_0_30px_#00f3ff] relative z-10" />
                 <!-- Decorative Rings -->
                 <div class="absolute inset-0 border-4 border-cyan-500/20 rounded-full animate-ping scale-150 opacity-20"></div>
              </div>
              
              <div class="space-y-2">
                <h2 class="text-6xl font-black text-white italic tracking-tighter uppercase scale-y-110 drop-shadow-[2px_2px_0px_#00f3ff44]">Mission_Restore_Success</h2>
                <div class="h-1.5 w-48 bg-cyan-500 mx-auto shadow-[0_0_20px_#00f3ff]"></div>
                <div class="text-[10px] text-cyan-500/60 font-mono tracking-[0.5em] uppercase mt-4 italic">Final_System_Integrity_Confirmed</div>
              </div>
            </div>

            <!-- Score Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
              <div v-for="(val, key, index) in { 'CONCEPT': userScore.step1, 'LOGIC': userScore.step2, 'CODE': userScore.step3, 'DEEP_DIVE': userScore.step4 }" :key="key" 
                   class="bg-white/[0.03] border border-white/5 p-8 hud-box-clip hover:bg-cyan-500/10 transition-all text-left group/card relative animate-in fade-in slide-in-from-bottom-5"
                   :style="{ animationDelay: (400 + index * 100) + 'ms' }">
                <div class="absolute top-0 right-0 p-3 opacity-10 group-hover/card:opacity-30 transition-opacity">
                   <div class="text-[8px] font-mono text-cyan-500 flex flex-col items-end">
                      <span>SEC_{{ index + 1 }}</span>
                      <span>UID_0x{{ (index * 123 + 456).toString(16).toUpperCase() }}</span>
                   </div>
                </div>
                <div class="text-[10px] font-black text-cyan-500/40 uppercase tracking-widest mb-4 italic group-hover/card:text-cyan-400 transition-colors">{{ key }}_CORE</div>
                <div class="flex items-baseline gap-2 mb-6">
                  <span class="text-4xl font-black text-white italic group-hover/card:scale-110 transition-transform origin-left">{{ val }}</span>
                  <span class="text-xs text-gray-700 font-mono">/ 25</span>
                </div>
                <!-- Mini Progress Bar -->
                <div class="h-1 bg-white/5 w-full relative overflow-hidden">
                  <div class="absolute inset-y-0 left-0 bg-cyan-500 transition-all duration-1000" :style="{ width: (val / 25 * 100) + '%' }"></div>
                </div>
              </div>
            </div>

            <!-- Intelligence Review Hardware Module -->
            <div class="bg-black/40 border border-cyan-500/20 p-10 hud-box-clip text-left relative overflow-hidden animate-in fade-in slide-in-from-bottom-10 delay-1000">
               <!-- Scanline effect for this box -->
               <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] pointer-events-none opacity-10"></div>
               
               <div class="flex items-start gap-10">
                 <!-- Mascot Placeholder or Icon -->
                 <div class="shrink-0 hidden lg:block">
                    <div class="w-24 h-24 bg-cyan-500/5 border border-cyan-500/20 hud-box-clip flex items-center justify-center relative">
                       <Terminal class="w-10 h-10 text-cyan-400 opacity-40" />
                       <div class="absolute -top-1 -right-1 w-3 h-3 bg-cyan-500 rounded-full animate-pulse shadow-[0_0_10px_#00f3ff]"></div>
                    </div>
                 </div>

                 <div class="flex-1 space-y-6">
                   <h3 class="text-cyan-400 font-black text-xs uppercase tracking-[0.4em] italic flex items-center gap-4">
                     <span class="w-2 h-2 bg-cyan-500 rounded-full animate-ping"></span>
                     Lion_Artificial_Intelligence_Review
                   </h3>
                   <p class="text-[19px] text-gray-200 leading-relaxed font-bold italic border-l-4 border-cyan-500/30 pl-8" v-html="finalReviewText"></p>
                   
                   <div class="flex gap-4 opacity-30 text-[9px] font-mono text-cyan-500 uppercase tracking-tighter">
                      <span>STATUS: ANALYZED</span>
                      <span>COMPLETION: 100%</span>
                      <span>DATA_SYNC: VERIFIED</span>
                   </div>
                 </div>
               </div>
            </div>

            <!-- Final Actions -->
            <div class="flex flex-col sm:flex-row gap-8 justify-center items-center">
              <button
                @click="reloadApp"
                class="group px-14 py-6 bg-white/5 hover:bg-white/10 text-gray-500 hover:text-white font-black uppercase tracking-[0.2em] text-xs border border-white/5 hover:border-white/20 hud-button-clip transition-all active:scale-95 flex items-center gap-4"
              >
                 <RotateCcw class="w-4 h-4 group-hover:rotate-180 transition-transform duration-700" />
                 Recalibrate_System
              </button>
              <button
                @click="$emit('close')"
                class="group px-14 py-6 bg-cyan-600 text-black font-black uppercase tracking-[0.2em] text-xs hud-button-clip hover:bg-cyan-400 hover:shadow-[0_0_30px_#00f3ff] transition-all active:scale-95 flex items-center gap-4"
              >
                 <ChevronRight class="w-5 h-5 group-hover:translate-x-1 transition-transform" />
                 Return_To_Hub_Command
              </button>
            </div>
          </div>
        </div>

        <!-- Duck Component - Repositioned for Step 5 -->
        <div class="fixed bottom-10 right-10 scale-125 z-50">
          <div class="bg-black/60 border border-cyan-500 px-6 py-3 hud-box-clip text-cyan-400 font-black text-[10px] tracking-widest italic mb-2 text-center animate-bounce">
            ì£¼ë‹ˆì–´ ì˜¤ë¦¬ (ì‚¬ì›)
          </div>
          <Duck class-name="shadow-neon cursor-help animate-in zoom-in slide-in-from-right-20 delay-1500" />
        </div>
      </div>


      <!-- Feedback HUD Modal -->
      <div v-if="feedbackModal.visible" class="fixed inset-0 bg-black/95 flex items-center justify-center z-[110] p-6 backdrop-blur-xl">
        <div class="bg-[#020408] border-2 border-white/10 hud-box-clip p-12 max-w-2xl w-full shadow-[0_0_100px_rgba(0,0,0,1)] relative animate-scale-in">
          <div class="absolute top-0 right-0 p-4 opacity-10">
             <div class="flex gap-2">
                <div v-for="i in 5" :key="i" class="w-1 h-1 bg-white"></div>
             </div>
          </div>

          <div class="flex items-center space-x-6 mb-10">
            <div :class="feedbackModal.isSuccess ? 'bg-green-500/20 text-green-400' : 'bg-pink-500/20 text-pink-400'" class="p-4 border border-current rounded-xl">
              <component
                :is="feedbackModal.isSuccess ? CheckCircle : AlertTriangle"
                class="w-12 h-12"
              />
            </div>
            <h3 class="text-3xl font-black text-white italic tracking-tighter uppercase">{{ feedbackModal.title }}</h3>
          </div>

          <p class="text-xl text-gray-200 mb-10 leading-relaxed font-bold italic border-l-4 px-6" :class="feedbackModal.isSuccess ? 'border-green-500' : 'border-pink-500'">{{ feedbackModal.desc }}</p>
          
          <div class="bg-white/[0.03] p-8 border border-white/5 text-sm font-medium text-gray-400 mb-12 leading-relaxed" v-html="feedbackModal.details"></div>
          
          <div class="flex justify-end">
            <button
              @click="nextStep"
              class="group relative h-16 transition-all active:scale-[0.98]"
            >
               <div class="absolute -inset-1 bg-cyan-500/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-300"></div>
               <div class="relative px-12 h-full bg-cyan-600 text-black font-black uppercase tracking-[0.2em] flex items-center gap-4 hud-button-clip hover:bg-cyan-400 hover:shadow-[0_0_20px_#00f3ff] transition-all">
                  {{ currentStep === 4 ? "GENERATE_REPORT" : "INITIALIZE_NEXT_PROTOCOL" }} 
                  <ChevronRight class="w-6 h-6" />
               </div>
            </button>
          </div>
        </div>
      </div>


      <!-- Duck Helper - Integrated Absolute Positioning (Hidden on Final Report) -->
      <div v-if="currentStep !== 5" class="absolute bottom-10 right-10 z-20 pointer-events-auto">
        <Duck class-name="shadow-neon hover:scale-110 transition-transform cursor-pointer" />
      </div>
    </main>
    </div>
  </div>
</template>

<script setup>
/**
 * ìˆ˜ì •ì¼: 2026-01-30
 * ìˆ˜ì •ë‚´ìš©: HTML í•˜ì´ë¸Œë¦¬ë“œ ì½”ë“œë¥¼ ì •ì‹ Vue SFC êµ¬ì¡°ë¡œ ë¦¬íŒ©í† ë§ ë° Lucide ì•„ì´ì½˜ ì ìš©
 */
import { ref, reactive, computed, watch, nextTick } from 'vue'
import { 
  Terminal, 
  Cpu, 
  Code as CodeIcon, 
  Award, 
  RotateCcw, 
  ChevronRight, 
  AlertTriangle, 
  CheckCircle,
  X 
} from 'lucide-vue-next'
import Duck from './components/Duck.vue'

const props = defineProps({
  isOpen: { type: Boolean, default: false }
})

const emit = defineEmits(['close'])


// --- State ---
const currentStep = ref(1)
const userScore = reactive({ step1: 0, step2: 0, step3: 0, step4: 0 })

// Step 1 Options
const step1Options = [
  "ë°ì´í„°ì˜ ìš©ëŸ‰ì„ ì¤„ì—¬ì„œ ì €ì¥ ê³µê°„ì„ ì•„ë¼ê¸° ìœ„í•´",
  "ë³µì¡í•œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ í•™ìŠµ ì†ë„ë¥¼ ëŠ¦ì¶”ê¸° ìœ„í•´",
  "ë…¸ì´ì¦ˆê°€ ì„ì¸ ë°ì´í„°ê°€ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ì €í•˜ì‹œí‚¤ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´",
  "ëª¨ë“  ë°ì´í„°ë¥¼ ê¸ì •ì ì¸ ë‚´ìš©ìœ¼ë¡œ ë°”ê¾¸ê¸° ìœ„í•´"
]

// Step 2 Data
const pseudoInput = ref('')
const chatMessages = ref([
  { sender: 'Lion', text: 'ì—”ì§€ë‹ˆì–´ë‹˜, ê¹¨ì–´ë‚˜ì…¨êµ°ìš”. ì˜¤ì—¼ëœ ë°ì´í„°ë¥¼ ì •í™”í•´ì•¼ ì œ ê¸°ì–µì´ ëŒì•„ì˜µë‹ˆë‹¤. ì˜¤ë¥¸ìª½ íŒ¨ë„ì— í•œê¸€ë¡œ ë¡œì§ì„ ì„¤ê³„í•´ì£¼ì„¸ìš”.' }
])
const chatContainer = ref(null)

// Step 3 Data
const blocks = [
  { id: 'b1', text: 'continue' },
  { id: 'b2', text: 'break' },
  { id: 'b3', text: 'append(text)' },
  { id: 'b4', text: 'remove(text)' }
]
const selectedBlock = ref(null)
const pythonBlanks = reactive({ blankA: null, blankB: null })
const simulationOutput = ref('')
const simulationContainer = ref(null)
const isSimulating = ref(false)

const sampleData = [
    "ì‚¼ì„±ì „ì ì£¼ê°€ ê¸‰ë“±",           // ì •ìƒ
    "ê´‘ê³ ) ì§€ê¸ˆ ë°”ë¡œ í´ë¦­í•˜ì„¸ìš”",    // í‚¤ì›Œë“œ í•„í„°ë§ ëŒ€ìƒ
    "ë‚ ì”¨",                        // ê¸¸ì´ ë¯¸ë§Œ ëŒ€ìƒ
    "AI ëª¨ë¸ì˜ ë¯¸ë˜ ì „ë§",          // ì •ìƒ
    "ì´ˆíŠ¹ê°€ ê´‘ê³  ìƒí’ˆ ì•ˆë‚´"         // í‚¤ì›Œë“œ í•„í„°ë§ ëŒ€ìƒ
];

// Step 4 Options
const step4Options = [
  "'ê´‘ê³ ' ë‹¨ì–´ê°€ í¬í•¨ëœ ëª¨ë“  ë¬¸ì„œë¥¼ ë¬´ì¡°ê±´ ì‚­ì œí•œë‹¤.",
  "ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ ëŒ€ì‹ , ë¬¸ë§¥ì„ ì´í•´í•˜ëŠ” AI ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ í•„í„°ë§í•œë‹¤.",
  "ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ì•„ì˜ˆ í•˜ì§€ ì•ŠëŠ”ë‹¤.",
  "ì‚¬ëŒì´ ëª¨ë“  ë°ì´í„°ë¥¼ ì§ì ‘ ì½ê³  ì§€ìš´ë‹¤."
]

// Feedback Modal
const feedbackModal = reactive({
  visible: false,
  title: '',
  desc: '',
  details: '',
  isSuccess: true
})

// --- Methods & Logic ---

// Helper: Scroll Chat
const scrollToBottom = () => {
  nextTick(() => {
    if (chatContainer.value) {
      chatContainer.value.scrollTop = chatContainer.value.scrollHeight
    }
  })
}

// Watch pseudoInput for hints
watch(pseudoInput, (newVal) => {
  if (newVal.length > 10 && !chatMessages.value.some(m => m.text.includes('ì‹œì‘'))) {
    chatMessages.value.push({ sender: 'Lion', text: 'ì¢‹ìŠµë‹ˆë‹¤. ë¨¼ì € ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© êº¼ë‚´ëŠ” "ë°˜ë³µ" êµ¬ì¡°ê°€ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.' })
    scrollToBottom()
  }
  if (newVal.includes('ë§Œì•½') && !chatMessages.value.some(m => m.text.includes('ì¡°ê±´'))) {
    chatMessages.value.push({ sender: 'Lion', text: 'ì¡°ê±´ë¬¸ì„ ì˜ ì‘ì„±í•˜ê³  ê³„ì‹œêµ°ìš”. "ì œê±°"í•˜ê±°ë‚˜ "ì €ì¥"í•˜ëŠ” í–‰ë™ë„ ëª…ì‹œí•´ì£¼ì„¸ìš”.' })
    scrollToBottom()
  }
})

// Step 1 Submit
const handleStep1Submit = (idx) => {
  const isCorrect = idx === 2
  userScore.step1 = isCorrect ? 25 : 0
  showFeedback(
    isCorrect ? "âœ… ì •ë‹µ: GIGO ì›ì¹™ì˜ ì´í•´" : "âš ï¸ ì˜¤ë‹µ: ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”",
    isCorrect ? "í›Œë¥­í•©ë‹ˆë‹¤. 'ì“°ë ˆê¸°ê°€ ë“¤ì–´ê°€ë©´ ì“°ë ˆê¸°ê°€ ë‚˜ì˜¨ë‹¤(Garbage In, Garbage Out)'ëŠ” AI ì—”ì§€ë‹ˆì–´ë§ì˜ ì œ1ì›ì¹™ì…ë‹ˆë‹¤. ì•„ë¬´ë¦¬ ì¢‹ì€ ëª¨ë¸ë„ ë°ì´í„°ê°€ ë”ëŸ¬ìš°ë©´ ì†Œìš©ì—†ìŠµë‹ˆë‹¤." : "ë°ì´í„°ì˜ ì–‘ë³´ë‹¤ëŠ” 'ì§ˆ'ì´ ìš°ì„ ì…ë‹ˆë‹¤. ë…¸ì´ì¦ˆê°€ ì„ì¸ ë°ì´í„°ëŠ” ëª¨ë¸ì˜ íŒë‹¨ë ¥ì„ íë¦¬ê²Œ ë§Œë“­ë‹ˆë‹¤.",
    "í™œìš© ì‚¬ë¡€: ì‹¤ì œ í˜„ì—…ì—ì„œë„ ì „ì²´ í”„ë¡œì íŠ¸ ê¸°ê°„ì˜ 80%ë¥¼ ë°ì´í„° ì „ì²˜ë¦¬ì— ì‚¬ìš©í•©ë‹ˆë‹¤. ê¸ˆìœµ ì‚¬ê¸° íƒì§€ ëª¨ë¸ì—ì„œ ì •ìƒ ê±°ë˜ë¥¼ ì‚¬ê¸°ë¡œ ì˜¤í•´í•˜ì§€ ì•Šê²Œ í•˜ë ¤ë©´ ë…¸ì´ì¦ˆ ì œê±°ê°€ í•„ìˆ˜ì ì…ë‹ˆë‹¤.",
    isCorrect
  )
}

// Step 2 Submit
function submitStep2() {
    const code = pseudoInput.value.trim();
    
    // 1. ë¶„ì„ì„ ìœ„í•œ ê·œì¹™ ì •ì˜ (ì •ê·œí‘œí˜„ì‹ í™œìš©)
    const rules = {
        loop: {
            pattern: /(ë°˜ë³µ|í•˜ë‚˜ì”©|êº¼ë‚´|ëª¨ë“ |ë¦¬ìŠ¤íŠ¸|for|each)/,
            desc: "ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© í™•ì¸í•˜ëŠ” 'ë°˜ë³µ' êµ¬ì¡°"
        },
        condition: {
            pattern: /(ë§Œì•½|ì¼ ë•Œ|ê²½ìš°|ë¼ë©´|if|ì¡°ê±´)/,
            desc: "íŠ¹ì • ë°ì´í„°ë¥¼ ì„ ë³„í•˜ëŠ” 'ì¡°ê±´ë¶„ê¸°'"
        },
        keywordCheck: {
            pattern: /(ê´‘ê³ |í´ë¦­|ê¸¸ì´|5ì|ë¯¸ë§Œ)/,
            desc: "ë¬¸ì œì—ì„œ ìš”êµ¬í•œ 'í•„í„°ë§ ê¸°ì¤€' ì–¸ê¸‰"
        },
        action: {
            pattern: /(ì œê±°|ì‚­ì œ|ë²„ë¦°|ì œì™¸|ê±´ë„ˆë›°|ì €ì¥|ì¶”ê°€|append|continue)/,
            desc: "ì¡°ê±´ì— ë”°ë¥¸ 'ì²˜ë¦¬ í–‰ë™'"
        }
    };

    let score = 0;
    let feedbackItems = [];
    let passedCount = 0;

    // 2. ê° ê·œì¹™ë³„ ê²€ì¦ ì§„í–‰
    Object.keys(rules).forEach(key => {
        const rule = rules[key];
        if (rule.pattern.test(code)) {
            score += 6.25; // 25ì  ë§Œì  ê¸°ì¤€ (4ê°€ì§€ í•­ëª©)
            passedCount++;
            feedbackItems.push(`<span class="text-green-400">âœ” ${rule.desc}ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.</span>`);
        } else {
            feedbackItems.push(`<span class="text-gray-500">âœ˜ ${rule.desc}ê°€ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ë¶ˆë¶„ëª…í•©ë‹ˆë‹¤.</span>`);
        }
    });

    // 3. ë…¼ë¦¬ì  ìˆœì„œ ì¶”ê°€ ê²€ì¦ (ë³´ë„ˆìŠ¤ ì ìˆ˜ ë˜ëŠ” ì •êµí™”)
    const loopPos = code.search(rules.loop.pattern);
    const condPos = code.search(rules.condition.pattern);
    
    let logicBonusText = "";
    if (loopPos !== -1 && condPos !== -1 && loopPos < condPos) {
        score = Math.min(25, score + 2.5); // ìˆœì„œê°€ ë§ìœ¼ë©´ ê°€ì‚°ì 
        logicBonusText = "<li class='text-cyan-400'>âœ¨ í›Œë¥­í•©ë‹ˆë‹¤! ë°ì´í„°ë¥¼ ë¨¼ì € êº¼ë‚´ê³  ì¡°ê±´ì„ ê²€ì‚¬í•˜ëŠ” ë…¼ë¦¬ì  ìˆœì„œê°€ ëª…í™•í•©ë‹ˆë‹¤.</li>";
    }

    userScore.step2 = Math.floor(score);

    // 4. í”¼ë“œë°± êµ¬ì„±
    const listHtml = `
        <div class="space-y-2">
            <p class="font-bold border-b border-white/10 pb-1">ì•Œê³ ë¦¬ì¦˜ êµ¬ì„± ìš”ì†Œ ì²´í¬:</p>
            <ul class="text-xs space-y-1">${feedbackItems.map(f => `<li>${f}</li>`).join('')}</ul>
            <div class="mt-4 pt-2 border-t border-white/10 text-sm">
                ${logicBonusText}
                <p class="mt-2 text-pink-400">Lionì˜ ì‹¬ì‚¬í‰: ${
                    passedCount >= 4 
                    ? "ì™„ë²½í•œ ì„¤ê³„ì…ë‹ˆë‹¤. ì´ì œ ì´ ë…¼ë¦¬ë¥¼ íŒŒì´ì¬ ì½”ë“œë¡œ ì˜®ê¸¸ ì¤€ë¹„ê°€ ë˜ì…¨êµ°ìš”!" 
                    : "ì„¤ê³„ê°€ ì¡°ê¸ˆ ì¶”ìƒì ì…ë‹ˆë‹¤. 'ë¬´ì—‡ì„(ëŒ€ìƒ)', 'ì–´ë–»ê²Œ(ë°©ë²•)' ì²˜ë¦¬í• ì§€ ëª…í™•íˆ ì ì–´ë³´ì„¸ìš”."
                }</p>
            </div>
        </div>
    `;

    showFeedback(
        score >= 20 ? "ğŸ’¡ ë…¼ë¦¬ ì„¤ê³„ í‰ê°€: ìš°ìˆ˜í•¨" : "ğŸ”§ ë…¼ë¦¬ ì„¤ê³„ í‰ê°€: ë³´ì™„ í•„ìš”",
        "Lionì˜ ì•Œê³ ë¦¬ì¦˜ ì—”ì§„ì´ ì—”ì§€ë‹ˆì–´ë‹˜ì˜ ì˜ì‚¬ì½”ë“œë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.",
        listHtml,
        score >= 15
    );
}

// Step 3 Logic
const selectBlock = (block) => {
  selectedBlock.value = block
}

const fillBlank = (blankId) => {
  if (!selectedBlock.value) return
  pythonBlanks[blankId] = selectedBlock.value
  selectedBlock.value = null
}

// Step 3 Simulation
const runSimulation = () => {
    const bA = pythonBlanks.blankA?.text; // continue, break ë“±
    const bB = pythonBlanks.blankB?.text; // append(text) ë“±
    
    if (!bA || !bB) {
        simulationOutput.value = '<span class="text-pink-500">Error: ë¹ˆì¹¸ì„ ëª¨ë‘ ì±„ì›Œì•¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>';
        return;
    }

    isSimulating.value = true;
    simulationOutput.value = '<span class="text-cyan-500">Initializing cleaning_protocol.v3...</span><br>';
    
    let cleaned_data = [];
    let log = '<span class="text-cyan-400 font-black tracking-widest uppercase text-[10px] italic">Checking system_integrity_protocol...</span><br>';

    for (let news of sampleData) {
        log += `<span class="text-gray-500 italic mt-2">Checking_Node: "${news}"</span><br>`;
        
        if (news.length < 5 || news.includes("ê´‘ê³ ")) {
            if (bA === 'continue') {
                log += `<span class="text-yellow-500 font-mono">&nbsp;&nbsp;[PROT_SKIP]: í•„í„°ë§ ì¡°ê±´ ì¼ì¹˜.</span><br>`;
                continue; 
            } else if (bA === 'break') {
                log += `<span class="text-red-500 font-mono">&nbsp;&nbsp;[PROT_HALT]: ë°˜ë³µë¬¸ ê°•ì œ ì¢…ë£Œë¨.</span><br>`;
                break;
            }
        }

        if (bB === 'append(text)') {
            cleaned_data.push(news);
            log += `<span class="text-green-500 font-mono">&nbsp;&nbsp;[DATA_SAVE]: ë°ì´í„°ê°€ cleaned_dataì— ì»¤ë°‹ë¨.</span><br>`;
        } else if (bB === 'remove(text)') {
            log += `<span class="text-pink-500 font-mono">&nbsp;&nbsp;[DATA_ERROR]: ì‚­ì œ ëª…ë ¹ì´ ìœ íš¨í•˜ì§€ ì•ŠìŒ.</span><br>`;
        }
    }

    log += `<br><strong class="text-white bg-cyan-700/30 px-2 py-1 italic tracking-widest uppercase text-[10px]">SYNC_COMPLETED: [${cleaned_data.join(', ')}]</strong>`;
    
    // Simulate a bit of delay for effect
    setTimeout(() => {
        simulationOutput.value = log;
        isSimulating.value = false;
        nextTick(() => {
            if (simulationContainer.value) {
                simulationContainer.value.scrollTop = simulationContainer.value.scrollHeight;
            }
        });
        
        // ì ìˆ˜ ë° ìµœì¢… ì œì¶œ ë¡œì§ ì—°ë™
        submitStep3(); 
    }, 800);
}

const submitStep3 = () => {
  const bA = pythonBlanks.blankA?.text === 'continue'
  const bB = pythonBlanks.blankB?.text === 'append(text)'

  let score = 0
  if (bA) score += 12
  if (bB) score += 13

  userScore.step3 = score
  showFeedback(
    score === 25 ? "ğŸ íŒŒì´ì¬ êµ¬í˜„: ì™„ë²½í•¨" : "ğŸ íŒŒì´ì¬ êµ¬í˜„: ì¼ë¶€ ì˜¤ë¥˜",
    score === 25 ? "ë…¼ë¦¬ë¥¼ ì½”ë“œë¡œ ì™„ë²½í•˜ê²Œ ë³€í™˜í•˜ì…¨ìŠµë‹ˆë‹¤." : "ì¼ë¶€ ë¡œì§ì´ ì˜ë„ì™€ ë‹¤ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    `<div class="space-y-2"><p><strong>ì„¤ëª…:</strong></p><p>1. <code>continue</code>ëŠ” í˜„ì¬ ë°˜ë³µì„ ê±´ë„ˆë›°ê³  ë‹¤ìŒ ë°ì´í„°ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p><p>2. ìœ íš¨í•œ ë°ì´í„°ë§Œ ë¦¬ìŠ¤íŠ¸ì— <code>append</code> í•´ì•¼ ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p></div>`,
    score > 15
  )
}

// Step 4 Submit
const handleStep4Submit = (idx) => {
  const isCorrect = idx === 1
  userScore.step4 = isCorrect ? 25 : 0
  showFeedback(
    isCorrect ? "âš–ï¸ ì‹¬í™” ë¶„ì„: íŠ¸ë ˆì´ë“œì˜¤í”„" : "ğŸ¤” ì‹¬í™” ë¶„ì„: ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”",
    isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤. ë„ˆë¬´ ì—„ê²©í•œ í•„í„°ë§ì€ ìœ ìš©í•œ ë°ì´í„°ê¹Œì§€ ë²„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤(False Positive)." : "ì•„ë‹™ë‹ˆë‹¤. í•„í„°ë§ì„ ë„ˆë¬´ ê°•í•˜ê²Œ í•˜ë©´ ì˜¤íˆë ¤ ë°ì´í„° ë¶€ì¡± í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "í™œìš© ì‚¬ë¡€: ìŠ¤íŒ¸ ë©”ì¼ í•„í„°ê°€ ë„ˆë¬´ ê°•ë ¥í•˜ë©´, ì¤‘ìš”í•œ ì—…ë¬´ ë©”ì¼ê¹Œì§€ ìŠ¤íŒ¸í†µìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ì—”ì§€ë‹ˆì–´ëŠ” í•­ìƒ 'ì •í™•ë„'ì™€ 'ì¬í˜„ìœ¨' ì‚¬ì´ì˜ ê· í˜•ì„ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.",
    isCorrect
  )
}

// Feedback Control
const showFeedback = (title, desc, details, isSuccess) => {
  feedbackModal.title = title
  feedbackModal.desc = desc
  feedbackModal.details = details
  feedbackModal.isSuccess = isSuccess
  feedbackModal.visible = true
}

const nextStep = () => {
  feedbackModal.visible = false
  if (currentStep.value < 5) currentStep.value++
}

const reloadApp = () => location.reload()

// Final Review Computed
const finalReviewText = computed(() => {
  let review = `ì—”ì§€ë‹ˆì–´ë‹˜ì€ ë°ì´í„°ê°€ AI ëª¨ë¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì •í™•íˆ ì´í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤. `
  review += userScore.step2 >= 20 ? "ìˆ˜ë„ì½”ë“œë¥¼ í†µí•œ ë…¼ë¦¬ êµ¬ì¡°í™” ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, " : "ìˆ˜ë„ì½”ë“œ ì‘ì„±ì— ì¡°ê¸ˆ ë” ì—°ìŠµì´ í•„ìš”í•´ ë³´ì´ì§€ë§Œ, "
  review += userScore.step3 >= 20 ? "íŒŒì´ì¬ ì½”ë“œë¡œì˜ ë³€í™˜ ëŠ¥ë ¥ë„ í›Œë¥­í•©ë‹ˆë‹¤." : "ì½”ë“œ êµ¬í˜„ ë””í…Œì¼ì„ ì¡°ê¸ˆë§Œ ë” ë‹¤ë“¬ìœ¼ë©´ í›Œë¥­í•œ ì—”ì§€ë‹ˆì–´ê°€ ë  ê²ƒì…ë‹ˆë‹¤."
  review += "<br/><br/>ì´ì œ ì˜¤ì—¼ëœ ë°ì´í„°ê°€ ì œê±°ë˜ì—ˆìœ¼ë‹ˆ, ë‹¤ìŒ ìŠ¤í…Œì´ì§€(RAG ì‹œìŠ¤í…œ êµ¬ì¶•)ë¡œ ë‚˜ì•„ê°ˆ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤."
  return review
})
</script>

<style scoped>
:root {
  --bg-dark: #0a0e17;
  --neon-cyan: #00f3ff;
  --neon-pink: #ff00ff;
}

.selection-cyan::selection {
  background-color: var(--neon-cyan);
  color: black;
}

/* Animation Classes */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* HUD Aesthetics */
.hud-box-clip {
  clip-path: polygon(
    0 0, 
    calc(100% - 20px) 0, 
    100% 20px, 
    100% 100%, 
    20px 100%, 
    0 calc(100% - 20px)
  );
}

.hud-button-clip {
  clip-path: polygon(
    0 0, 
    calc(100% - 10px) 0, 
    100% 10px, 
    100% 100%, 
    10px 100%, 
    0 calc(100% - 10px)
  );
}

@keyframes progressStripes {
  from { background-position: 0 0; }
  to { background-position: 40px 0; }
}

.animate-progress-stripes {
  background-image: linear-gradient(
    45deg, 
    rgba(255,255,255,0.1) 25%, 
    transparent 25%, 
    transparent 50%, 
    rgba(255,255,255,0.1) 50%, 
    rgba(255,255,255,0.1) 75%, 
    transparent 75%, 
    transparent
  );
  background-size: 40px 40px;
  animation: progressStripes 2s linear infinite;
}

@keyframes scanline {
  0% { transform: translateY(-100%); }
  100% { transform: translateY(100%); }
}

.shadow-neon {
  filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.4));
}

</style>